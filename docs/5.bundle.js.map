{"version":3,"sources":["webpack:///./util/entryrender.js","webpack:///./components/dnd-select-add.js","webpack:///./components/dnd-button.js","webpack:///./components/dnd-asi-select.js","webpack:///./data/choices.js","webpack:///./components/views/character/dnd-character-builder-class.js"],"names":["EntryRenderer","this","wrapperTag","baseUrl","setWrapperTag","tag","setBaseUrl","url","recursiveEntryRender","entry","textStack","depth","prefix","suffix","forcePrefixSuffix","type","renderPrefix","undefined","handleEntriesOptionsInvocationPatron","self","entries","sort","a","b","name","handleOptions","items","push","style","i","length","source","caption","colLabels","getTableThClassText","rows","j","makeTableTdClassText","colStyles","rowStyles","renderTable","handleInvocation","handlePatron","attributes","renderSuffix","value","getEntryDice","href","path","hash","subhashes","subHash","key","text","renderLink","renderString","incDepth","inlineTitle","nextDepth","styleString","styleClasses","HEAD_2","HEAD_NEG_1","HEAD_0","HEAD_1","subclass","join","getStyleString","dataString","titleString","sourceJsonToFull","DATA_NONE","getDataString","preReqText","prerequisite","headerSpan","tagSplit","char","char2","tagDepth","inTag","out","curStr","charAt","splitByTags","s","string","substr","indexOf","actionToExplanation","skillToExplanation","displayText","others","split","fauxEntry","classMatch","RE_INLINE_CLASS","exec","trim","substring","toAdd","number","faces","String","toRoll","roll","droll","rollable","DndSelectAdd","test","Boolean","reflectToAttribute","options","Array","observer","model","addCallback","Function","choices","Number","label","placeholder","multiValue","listBox","remove","$","select","render","isArray","choiceArray","map","v","findIndex","o","filter","selectedValues","super","ready","setTimeout","async","renderer","root","document","createElement","setAttribute","addEventListener","e","opened","wasPreviouslySelected","srcElement","getAttribute","splice","selectedOptions","option","item","textContent","appendChild","_assignMenuElement","valueUpdated","connectedCallback","selectChangeHandler","val","selected","disconnectedCallback","removeEventListener","customElements","define","icon","button","levelIndex","checked","selectedFeat","Object","selectedAbility1","selectedAbility2","featHasAttributeChoice","featAttributeSelection","featAttributeOptions","attributeOptions","switchChangeHandler","detail","_genASICallback","characterChangeHandler","character","updateFromCharacter","asi","index","feat","ability1","ability2","isFeat","featId","featRef","ability","choose","from","toUpperCase","featAttributeSelections","asiIndex","keyForChange","newVal","classOptionsMap","class","2","count","5","10","15","20","4","7","11","19","artificer","6","14","18","barbarian","subclasses","3","bard","levels","classes","heightByRows","window","innerWidth","isEditMode","editModeHandler","classGrid","rowDetailsRenderer","grid","rowData","firstElementChild","innerHTML","renderStack","features","_getClassLevelFeatures","feature","deets","querySelector","bind","JSON","parse","stringify","classChoices","_findLevelChoices","dispatchEvent","CustomEvent","bubbles","composed","clearCache","className","classRef","classFeatures","levelsInClass","levelsInSubclass","classFeaturesForLevel","find","gainSubclassFeature","some","subclassDef","subclassFeatures","isSubclass","concat","classLevelFeatures","f","__data","data","stayClosed","detailsOpenedItems","closeItemDetails","openItemDetails","levelChoices","_findChoices","classDef","classLevelCount","subclassChoiceLevel","id","selections","classSkillOptions","startingProficiencies","skills","classSkillProficiencies","classOptions","toLowerCase","classLevelOptions","classLevelOption","level","subclassLevelOptions","subclassLevelOption","classs","choice","adjChoice","c","obj","values","replace"],"mappings":"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","file":"5.bundle.js","sourcesContent":["import { isNonstandardSource, encodeForHash, ascSort, utils_makeAttChoose } from \"../js/utils.js\";\r\nimport {\r\n  CLSS_NON_STANDARD_SOURCE,\r\n  HASH_LIST_SEP,\r\n  ATB_DATA_SC,\r\n  ATB_DATA_SRC,\r\n  CLSS_SUBCLASS_FEATURE,\r\n\tSRC_MM,\r\n\tSRC_PHB,\r\n\tSRC_DMG\r\n} from \"../util/consts.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n// ENTRY RENDERING =====================================================================================================\r\n/*\r\n * // EXAMPLE USAGE //\r\n *\r\n * const entryRenderer = new EntryRenderer();\r\n *\r\n * const topLevelEntry = mydata[0];\r\n * // prepare an array to hold the string we collect while recursing\r\n * const textStack = [];\r\n *\r\n * // recurse through the entry tree\r\n * entryRenderer.renderEntries(topLevelEntry, textStack);\r\n *\r\n * // render the final product by joining together all the collected strings\r\n * $(\"#myElement\").html(toDisplay.join(\"\"));\r\n */\r\nfunction EntryRenderer() {\r\n\r\n\tthis.wrapperTag = \"div\";\r\n\tthis.baseUrl = \"\";\r\n\r\n\t/**\r\n\t * Set the tag used to group rendered elements\r\n\t * @param tag to use\r\n\t */\r\n\tthis.setWrapperTag = function (tag) {\r\n\t\tthis.wrapperTag = tag;\r\n\t};\r\n\r\n\t/**\r\n\t * Set the base url for rendered links.\r\n\t * Usage: `renderer.setBaseUrl(\"https://www.cool.site/\")` (note the \"http\" prefix and \"/\" suffix)\r\n\t * @param url to use\r\n\t */\r\n\tthis.setBaseUrl = function(url) {\r\n\t\tthis.baseUrl = url;\r\n\t};\r\n\r\n\t/**\r\n\t * Recursively walk down a tree of \"entry\" JSON items, adding to a stack of strings to be finally rendered to the\r\n\t * page. Note that this function does _not_ actually do the rendering, see the example code above for how to display\r\n\t * the result.\r\n\t *\r\n\t * @param entry An \"entry\" usually defined in JSON. A schema is available in tests/schema\r\n\t * @param textStack A reference to an array, which will hold all our strings as we recurse\r\n\t * @param depth The current recursion depth. Optional; default 0, or -1 for type \"section\" entries\r\n\t * @param prefix The (optional) prefix to be added to the textStack before whatever is added by the current call\r\n\t * @param suffix The (optional) suffix to be added to the textStack after whatever is added by the current call\r\n\t * @param forcePrefixSuffix force the prefix and suffix to be added (useful for the first call from external code)\r\n\t */\r\n\tthis.recursiveEntryRender = function(entry, textStack, depth, prefix, suffix, forcePrefixSuffix) {\r\n\t\tdepth = depth === undefined || depth === null ? entry.type === \"section\" ? -1 : 0 : depth;\r\n\t\tprefix = prefix === undefined || prefix === null ? null : prefix;\r\n\t\tsuffix = suffix === undefined || suffix === null ? null : suffix;\r\n\t\tforcePrefixSuffix = forcePrefixSuffix === undefined || forcePrefixSuffix === null ? false : forcePrefixSuffix;\r\n\r\n\t\tif (forcePrefixSuffix) renderPrefix();\r\n\t\tif (typeof entry === \"object\") {\r\n\t\t\t// the root entry (e.g. \"Rage\" in barbarian \"classFeatures\") is assumed to be of type \"entries\"\r\n\t\t\tconst type = entry.type === undefined || entry.type === \"section\" ? \"entries\" : entry.type;\r\n\t\t\tswitch (type) {\r\n\t\t\t\t// TODO add an \"insert box\" type\r\n\r\n\t\t\t\t// recursive\r\n\t\t\t\tcase \"entries\":\r\n\t\t\t\t\thandleEntries(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"options\":\r\n\t\t\t\t\thandleOptions(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"list\":\r\n\t\t\t\t\tif (entry.items) {\r\n\t\t\t\t\t\ttextStack.push(`<ul ${entry.style ? `class=\"${entry.style}\"` : ''}>`);\r\n\t\t\t\t\t\tfor (let i = 0; i < entry.items.length; i++) {\r\n\t\t\t\t\t\t\tthis.recursiveEntryRender(entry.items[i], textStack, depth + 1, `<li ${isNonstandardSource(entry.items[i].source) ? `class=\"${CLSS_NON_STANDARD_SOURCE}\"` : \"\"}>`, \"</li>\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttextStack.push(\"</ul>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"table\":\r\n\t\t\t\t\trenderTable(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"invocation\":\r\n\t\t\t\t\thandleInvocation(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"patron\":\r\n\t\t\t\t\thandlePatron(this);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// block\r\n\t\t\t\tcase \"abilityDc\":\r\n\t\t\t\t\trenderPrefix();\r\n\t\t\t\t\ttextStack.push(`<span class='spell-ability'><span>${entry.name} save DC</span> = 8 + your proficiency bonus + your ${utils_makeAttChoose(entry.attributes)}</span>`);\r\n\t\t\t\t\trenderSuffix();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"abilityAttackMod\":\r\n\t\t\t\t\tif (prefix !== null) textStack.push(prefix);\r\n\t\t\t\t\ttextStack.push(`<span class='spell-ability'><span>${entry.name} attack modifier</span> = your proficiency bonus + your ${utils_makeAttChoose(entry.attributes)}</span>`);\r\n\t\t\t\t\tif (suffix !== null) textStack.push(suffix);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// inline\r\n\t\t\t\tcase \"inline\":\r\n\t\t\t\t\tif (entry.entries) {\r\n\t\t\t\t\t\tfor (let i = 0; i < entry.entries.length; i++) {\r\n\t\t\t\t\t\t\tthis.recursiveEntryRender(entry.entries[i], textStack, depth);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bonus\":\r\n\t\t\t\t\ttextStack.push((entry.value < 0 ? \"\" : \"+\") + entry.value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bonusSpeed\":\r\n\t\t\t\t\ttextStack.push((entry.value < 0 ? \"\" : \"+\") + entry.value + \"ft.\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"dice\":\r\n\t\t\t\t\ttextStack.push(EntryRenderer.getEntryDice(entry));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"link\":\r\n\t\t\t\t\trenderLink(this, entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"item\":\r\n\t\t\t\t\ttextStack.push(`<li><b>${entry.name}: </b>`);\r\n\t\t\t\t\tthis.recursiveEntryRender(entry.entry, textStack, depth);\r\n\t\t\t\t\ttextStack.push('</li>');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"print\":\r\n\t\t\t\t\ttextStack.push(renderString(entry.entry));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else if (typeof entry === \"string\") { // block\r\n\t\t\trenderPrefix();\r\n\t\t\trenderString(this);\r\n\t\t\trenderSuffix();\r\n\t\t} else { // block\r\n\t\t\t// for ints or any other types which do not require specific rendering\r\n\t\t\trenderPrefix();\r\n\t\t\ttextStack.push(entry);\r\n\t\t\trenderSuffix();\r\n\t\t}\r\n\t\tif (forcePrefixSuffix) renderSuffix();\r\n\r\n\t\tfunction renderPrefix() {\r\n\t\t\tif (prefix !== null) {\r\n\t\t\t\ttextStack.push(prefix);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction renderSuffix() {\r\n\t\t\tif (suffix !== null) {\r\n\t\t\t\ttextStack.push(suffix);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction renderTable(self) {\r\n\t\t\t// TODO add handling for rowLabel property\r\n\r\n\t\t\ttextStack.push(\"<table class='table'>\");\r\n\r\n\t\t\tif (entry.caption !== undefined) {\r\n\t\t\t\ttextStack.push(`<caption>${entry.caption}</caption>`);\r\n\t\t\t}\r\n\t\t\ttextStack.push(\"<thead>\");\r\n\t\t\ttextStack.push(\"<tr class='table-row table-row--header'>\");\r\n\r\n\t\t\tif (entry.colLabels) {\r\n\t\t\t\tfor (let i = 0; i < entry.colLabels.length; ++i) {\r\n\t\t\t\t\ttextStack.push(`<th ${getTableThClassText(i)}>${entry.colLabels[i]}</th>`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttextStack.push(\"</tr>\");\r\n\t\t\ttextStack.push(\"</thead>\");\r\n\t\t\ttextStack.push(\"<tbody>\");\r\n\r\n\t\t\tfor (let i = 0; i < entry.rows.length; ++i) {\r\n\t\t\t\ttextStack.push(\"<tr class='table-row'>\");\r\n\t\t\t\tfor (let j = 0; j < entry.rows[i].length; ++j) {\r\n\t\t\t\t\ttextStack.push(`<td ${makeTableTdClassText(j)}>`);\r\n\t\t\t\t\tself.recursiveEntryRender(entry.rows[i][j], textStack, depth + 1);\r\n\t\t\t\t\ttextStack.push(\"</td>\");\r\n\t\t\t\t}\r\n\t\t\t\ttextStack.push(\"</tr>\");\r\n\t\t\t}\r\n\r\n\t\t\ttextStack.push(\"</tbody>\");\r\n\t\t\ttextStack.push(\"</table>\");\r\n\r\n\t\t\tfunction getTableThClassText(i) {\r\n\t\t\t\treturn entry.colStyles === undefined || i >= entry.colStyles.length ? \"class='table-cell'\" :  `class=\"table-cell ${entry.colStyles[i]}\"`;\r\n\t\t\t}\r\n\r\n\t\t\tfunction makeTableTdClassText(i) {\r\n\t\t\t\tif (entry.rowStyles !== undefined) {\r\n\t\t\t\t\treturn entry.rowStyles === undefined || i >= entry.rowStyles.length ? \"class='table-cell'\" : `class=\"table-cell ${entry.rowStyles[i]}\"`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn getTableThClassText(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction handleEntries(self) {\r\n\t\t\thandleEntriesOptionsInvocationPatron(self, true);\r\n\t\t}\r\n\r\n\t\tfunction handleOptions(self) {\r\n\t\t\tif (entry.entries) {\r\n\t\t\t\tentry.entries = entry.entries.sort((a, b) => a.name && b.name ? ascSort(a.name, b.name) : a.name ? -1 : b.name ? 1 : 0);\r\n\t\t\t\thandleEntriesOptionsInvocationPatron(self, false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction handleInvocation(self) {\r\n\t\t\thandleEntriesOptionsInvocationPatron(self, true);\r\n\t\t}\r\n\r\n\t\tfunction handlePatron(self) {\r\n\t\t\thandleEntriesOptionsInvocationPatron(self, false);\r\n\t\t}\r\n\r\n\t\tfunction handleEntriesOptionsInvocationPatron(self, incDepth) {\r\n\t\t\tconst inlineTitle = depth >= 2;\r\n\t\t\tconst nextDepth = incDepth ? depth+1 : depth;\r\n\t\t\tconst styleString = getStyleString();\r\n\t\t\tconst dataString = getDataString();\r\n\t\t\tconst preReqText = getPreReqText();\r\n\t\t\tconst headerSpan = entry.name !== undefined ? `<span class=\"stat-name\">${entry.name}${isNonstandardSource(entry.source) ? ' (UA)' : ''}${inlineTitle ? \".\" : \"\"}</span> ` : \"\";\r\n\r\n\t\t\tif (entry.entries || entry.name) {\r\n\t\t\t\ttextStack.push(`<${self.wrapperTag} ${dataString} ${styleString}>${headerSpan}${preReqText}`);\r\n\t\t\t\tif (entry.entries) {\r\n\t\t\t\t\tfor (let i = 0; i < entry.entries.length; i++) {\r\n\t\t\t\t\t\tself.recursiveEntryRender(entry.entries[i], textStack, nextDepth, \"<p>\", \"</p>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttextStack.push(`</${self.wrapperTag}>`);\r\n\t\t\t}\r\n\r\n\t\t\tfunction getStyleString() {\r\n\t\t\t\tconst styleClasses = [];\r\n\t\t\t\tif (isNonstandardSource(entry.source)) styleClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n\t\t\t\tif (inlineTitle && entry.name !== undefined) styleClasses.push(EntryRenderer.HEAD_2);\r\n\t\t\t\telse styleClasses.push(depth === -1 ? EntryRenderer.HEAD_NEG_1 : depth === 0 ? EntryRenderer.HEAD_0 : EntryRenderer.HEAD_1);\r\n\t\t\t\tif ((entry.type === \"invocation\" || entry.type === \"patron\") && entry.subclass !== undefined) styleClasses.push(CLSS_SUBCLASS_FEATURE);\r\n\t\t\t\treturn styleClasses.length > 0 ? `class=\"${styleClasses.join(\" \")}\"` : \"\";\r\n\t\t\t}\r\n\r\n\t\t\tfunction getDataString() {\r\n\t\t\t\tlet dataString = \"\";\r\n\t\t\t\tif (entry.type === \"invocation\" || entry.type === \"patron\") {\r\n\t\t\t\t\tconst titleString = entry.source ? `title=\"Source: ${Parser.sourceJsonToFull(entry.source)}\"` : \"\";\r\n\t\t\t\t\tif (entry.subclass !== undefined) dataString = `${ATB_DATA_SC}=\"${entry.subclass.name}\" ${ATB_DATA_SRC}=\"${entry.subclass.source}\" ${titleString}`;\r\n\t\t\t\t\telse dataString = `${ATB_DATA_SC}=\"${EntryRenderer.DATA_NONE}\" ${ATB_DATA_SRC}=\"${EntryRenderer.DATA_NONE}\" ${titleString}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn dataString;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getPreReqText() {\r\n\t\t\t\tif (entry.prerequisite) return `<span class=\"prerequisite\">Prerequisite: ${entry.prerequisite}</span>`;\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction renderLink(self, entry) {\r\n\t\t\tlet href;\r\n\t\t\tif (entry.href.type === \"internal\") {\r\n\t\t\t\t// baseURL is blank by default\r\n\t\t\t\thref = `${self.baseUrl}${entry.href.path}#`;\r\n\t\t\t\tif (entry.href.hash !== undefined) {\r\n\t\t\t\t\thref += entry.href.hash;\r\n\t\t\t\t\tif (entry.href.subhashes !== undefined) {\r\n\t\t\t\t\t\tfor (let i = 0; i < entry.href.subhashes.length; i++) {\r\n\t\t\t\t\t\t\tconst subHash = entry.href.subhashes[i];\r\n\t\t\t\t\t\t\thref += `,${encodeForHash(subHash.key)}:${encodeForHash(subHash.value)}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (entry.href.type === \"external\") {\r\n\t\t\t\thref = entry.href.url;\r\n\t\t\t}\r\n\t\t\ttextStack.push(`<a href='${href}'>${entry.text}</a>`);\r\n\t\t}\r\n\r\n\t\tfunction renderString(self) {\r\n\t\t\tconst tagSplit = splitByTags();\r\n\t\t\tfor (let i = 0; i < tagSplit.length; i++) {\r\n\t\t\t\tconst s = tagSplit[i];\r\n\t\t\t\tif (s === undefined || s === null || s === \"\") continue;\r\n\t\t\t\tif (s.charAt(0) === \"@\") {\r\n\t\t\t\t\tconst [tag, text] = splitFirstSpace(s);\r\n\r\n\t\t\t\t\tif (tag === \"@bold\" || tag === \"@b\" || tag === \"@italic\" || tag === \"@i\" || tag === \"@skill\" || tag === \"@action\") {\r\n\t\t\t\t\t\tswitch (tag) {\r\n\t\t\t\t\t\t\tcase \"@b\":\r\n\t\t\t\t\t\t\tcase \"@bold\":\r\n\t\t\t\t\t\t\t\ttextStack.push(`<b>`);\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(text, textStack, depth);\r\n\t\t\t\t\t\t\t\ttextStack.push(`</b>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@i\":\r\n\t\t\t\t\t\t\tcase \"@italic\":\r\n\t\t\t\t\t\t\t\ttextStack.push(`<i>`);\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(text, textStack, depth);\r\n\t\t\t\t\t\t\t\ttextStack.push(`</i>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@action\": // Convert this to a tag once the rules data are more navigable\r\n\t\t\t\t\t\t\t\ttextStack.push(`<span title=\"${Parser.actionToExplanation(text)}\" class=\"explanation\">${text}</span>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@skill\": // Convert this to a tag once the rules data are more navigable\r\n\t\t\t\t\t\t\t\ttextStack.push(`<span title=\"${Parser.skillToExplanation(text)}\" class=\"explanation\">${text}</span>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst [name, source, displayText, ...others] = text.split(\"|\");\r\n\t\t\t\t\t\tconst hash = `${name}${source ? `${HASH_LIST_SEP}${source}` : \"\"}`;\r\n\r\n\t\t\t\t\t\tconst fauxEntry = {\r\n\t\t\t\t\t\t\t\"type\": \"link\",\r\n\t\t\t\t\t\t\t\"href\": {\r\n\t\t\t\t\t\t\t\t\"type\": \"internal\",\r\n\t\t\t\t\t\t\t\t\"path\": \"\",\r\n\t\t\t\t\t\t\t\t\"hash\": encodeForHash(hash)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\"text\": (displayText ? displayText : name)\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tswitch (tag) {\r\n\t\t\t\t\t\t\tcase \"@spell\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_PHB;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/spells/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@item\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_DMG;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/items/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@condition\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_PHB;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/conditions/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@class\":\r\n\t\t\t\t\t\t\t\tconst classMatch = EntryRenderer.RE_INLINE_CLASS.exec(text);\r\n\t\t\t\t\t\t\t\tif (classMatch) {\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.hash = classMatch[1].trim(); // TODO pass this in\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.subhashes = [{\"key\": \"sub\", \"value\": classMatch[2].trim() + \"~phb\"}] // TODO pass this in\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_PHB;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/classes/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@creature\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_MM;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/bestiary/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@filter\":\r\n\t\t\t\t\t\t\t\t// todo... maybe\r\n\t\t\t\t\t\t\t\ttextStack.push(name);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@damage\":\r\n\t\t\t\t\t\t\tcase \"@dice\":\r\n\t\t\t\t\t\t\t\t// todo\r\n\t\t\t\t\t\t\t\ttextStack.push(name);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@book\":\r\n\t\t\t\t\t\t\t\t//todo\r\n\t\t\t\t\t\t\t\ttextStack.push(name);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@5etools\":\r\n\t\t\t\t\t\t\t\tif (source.indexOf(\".\") > -1) {\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/\" + source.substring(0, source.indexOf(\".\"))\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/\" + source;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttextStack.push(s);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction splitFirstSpace(string) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tstring.substr(0, string.indexOf(' ')),\r\n\t\t\t\t\tstring.substr(string.indexOf(' ') + 1)\r\n\t\t\t\t]\r\n\t\t\t}\r\n\r\n\t\t\tfunction splitByTags() {\r\n\t\t\t\tlet tagDepth = 0;\r\n\t\t\t\tlet inTag = false;\r\n\t\t\t\tlet char, char2;\r\n\t\t\t\tconst out = [];\r\n\t\t\t\tlet curStr = \"\";\r\n\t\t\t\tfor (let i = 0; i < entry.length; ++i) {\r\n\t\t\t\t\tchar = entry.charAt(i);\r\n\t\t\t\t\tchar2 = i < entry.length-1 ? entry.charAt(i+1) : null;\r\n\r\n\t\t\t\t\tswitch (char) {\r\n\t\t\t\t\t\tcase \"{\":\r\n\t\t\t\t\t\t\tif (char2 === \"@\") {\r\n\t\t\t\t\t\t\t\tif (tagDepth++ > 0) {\r\n\t\t\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tout.push(curStr);\r\n\t\t\t\t\t\t\t\t\tinTag = false;\r\n\t\t\t\t\t\t\t\t\tcurStr = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"}\":\r\n\t\t\t\t\t\t\tif (--tagDepth === 0) {\r\n\t\t\t\t\t\t\t\tout.push(curStr);\r\n\t\t\t\t\t\t\t\tcurStr = \"\";\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (curStr.length > 0) out.push(curStr);\r\n\r\n\t\t\t\treturn out;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nEntryRenderer.getEntryDice = function (entry) {\r\n\t// TODO make droll integration optional\r\n\tlet toAdd;\r\n\tif (entry.number && entry.faces) {\r\n\t\ttoAdd = String(entry.number) + \"d\" + entry.faces;\r\n\t} else if (entry.toRoll && entry.toRoll.length) {\r\n\t\tfor (let roll of entry.toRoll) {\r\n\t\t\ttoAdd = String(roll.number) + \"d\" + roll.faces + \" + \"\r\n\t\t}\r\n\t\ttoAdd = toAdd.substring(0, toAdd.length - 3);\r\n\t}\r\n\tif (typeof droll !== \"undefined\" && entry.rollable === true) {\r\n\t\t// TODO output this somewhere nice\r\n\t\t// TODO make this less revolting\r\n\r\n\t\t// TODO output to small tooltip-stype bubble? Close on mouseout\r\n\t\treturn `<span class='roller unselectable' onclick=\"if (this.rolled) { this.innerHTML = this.innerHTML.split('=')[0].trim()+' = '+droll.roll('${toAdd}').total; } else { this.rolled = true; this.innerHTML += ' = '+droll.roll('${toAdd}').total; }\">${toAdd}</span>`;\r\n\t} else {\r\n\t\treturn toAdd;\r\n\t}\r\n};\r\n\r\nEntryRenderer.RE_INLINE_CLASS = /(.*?) \\((.*?)\\)/;\r\nEntryRenderer.HEAD_NEG_1 = \"statsBlockSectionHead\";\r\nEntryRenderer.HEAD_0 = \"statsBlockHead\";\r\nEntryRenderer.HEAD_1 = \"statsBlockSubHead\";\r\nEntryRenderer.HEAD_2 = \"statsInlineHead\";\r\nEntryRenderer.DATA_NONE = \"data-none\";\r\n\r\nexport default EntryRenderer;","import { PolymerElement, html } from '@polymer/polymer';\nimport { mergeFeature } from '../util/charBuilder';\nimport { jqEmpty, util_capitalizeAll } from \"../js/utils\";\nimport \"@vaadin/vaadin-select\";\nimport {loadModel} from \"../util/data\";\n\nclass DndSelectAdd extends PolymerElement {\n  static get properties() {\n    return {\n      test: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      },\n      options: {\n        type: Array,\n        observer: \"optionsUpdated\"\n      },\n      model: {\n        type: String\n      },\n      addCallback: {\n        type: Function\n      },\n      value: {\n        type: String,\n        value: \"\",\n        observer: \"valueUpdated\"\n      },\n      choices: {\n        type: Number,\n        observer: \"choicesUpdated\"\n      },\n      label: {\n        type: String\n      },\n      placeholder: {\n        type: String,\n      },\n      multiValue: {\n        type: String,\n        value: \"\"\n      }\n    }\n  }\n\n  choicesUpdated() {\n    if (this.listBox) {\n      this.listBox.remove();\n      delete this.listBox;\n    }\n    this.$.select.render();\n  }\n\n  optionsUpdated() {\n    if (this.listBox) {\n      this.listBox.remove();\n      delete this.listBox;\n    }\n    this.$.select.render();\n  }\n\n  valueUpdated() {\n    if (this.choices) {\n      if (Array.isArray(this.value) && this.options) {\n        const choiceArray = this.value\n          .map(v => {\n            if (this.options.indexOf(v) !== -1) {\n              return this.options.indexOf(v);\n            } else {\n              return this.options.findIndex((o) => {\n                return o.name === v.name && o.source === v.source;\n              });\n            }\n          })\n          .filter(v => { return v !== -1 });\n\n        if (this.listBox) {\n          this.listBox.selectedValues = choiceArray;\n        }\n        this.multiValue = choiceArray.map(i => {\n          let value = this.options[i];\n          return value.name ? value.name : util_capitalizeAll(value) \n        }).join(\", \");\n      } else {\n        if (this.listBox) {\n          this.listBox.selectedValues = [];\n        }\n        this.multiValue = \"\";\n      }\n    } else {\n      if (this.value && this.options) {\n        if (this.value.name) {\n          this.$.select.value = this.options.findIndex(i => { return i.name === this.value.name || i === this.value.name }) + \"\";\n        } else {\n          this.$.select.value = this.options.findIndex(i => { return i.name === this.value || i === this.value }) + \"\";\n        }\n      } else {\n        this.$.select.value = \"\";\n      }\n    }\n  }\n\n  ready() {\n    super.ready();\n\n    setTimeout(async () => {\n      if (this.model) {\n        this.options = await loadModel(this.model);\n      }\n\n      this.$.select.renderer = (root, select) => {\n        if (!this.listBox) {\n          this.listBox = document.createElement('vaadin-list-box');\n\n          // setting up for multi-select\n          if (this.choices) {\n            this.listBox.setAttribute(\"multiple\", true);\n\n            this.listBox.addEventListener(\"click\", (e) => {\n              select.opened = true;\n              let wasPreviouslySelected = e.srcElement.getAttribute(\"selected\") !== null\n              setTimeout(() => {\n                if (this.listBox.selectedValues.length > this.choices\n                    && !wasPreviouslySelected) {\n                  this.listBox.selectedValues.splice(this.listBox.selectedValues.length - 2, 1)\n                }\n                let selectedOptions = this.listBox.selectedValues.map(v => { return this.options[v] });\n                this.multiValue = selectedOptions.map(o => { return o.name ? o.name : util_capitalizeAll(o) }).join(', ');\n                if (this.addCallback) {\n                  this.addCallback(selectedOptions);\n                }\n              }, 0);\n            });\n\n          }\n\n          // Adding options\n          if (this.options && this.options.length) {\n            for (let i = 0; i < this.options.length; i ++) {\n              const option = this.options[i],\n                item = document.createElement('vaadin-item');\n              if (option.name) {\n                item.textContent = option.name;\n                item.setAttribute(\"value\", i);\n              } else {\n                item.textContent = util_capitalizeAll(option);\n                item.setAttribute(\"value\", i);\n              }\n              this.listBox.appendChild(item);\n            }\n          }\n          root.appendChild(this.listBox);\n          this.$.select._assignMenuElement();\n\n          this.valueUpdated();\n        }\n      };\n    }, 0);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.selectChangeHandler = () => {\n      const val = this.$.select.value;\n      if (val) {\n        if (!this.choices) {\n          const selected = this.options[val];\n          if (this.addCallback) {\n            this.addCallback(selected, this.model);\n          } else {\n            mergeFeature(undefined, selected, this.model);\n          }\n          if (!this.value) {\n            this.$.select.value = \"\";\n          }\n        }\n      }\n    };\n\n    this.$.select.addEventListener(\"change\", this.selectChangeHandler);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    this.$.select.removeEventListener(\"change\", this.selectChangeHandler);\n  }\n\n  _exists(a) {\n    return !!a;\n  }\n\n  _label(label, choices) {\n    if (label) {\n      if (choices) {\n        return `${label} (${choices})`;\n      } else {\n        return label;\n      }\n    }\n  }\n  \n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: inline-block;\n        }\n        [slot=\"prefix\"] {\n          width: calc(100% - 46px);\n          padding: 12px;\n          line-height: 1.4;\n        }\n        vaadin-select {\n          width: 100%;\n        }\n        .prefix {\n          white-space: normal;\n          color: var(--lumo-body-text-color);\n        }\n      </style>\n      <vaadin-select test$=\"[[test]]\" theme=\"dark\" add id=\"select\" label=\"[[_label(label, choices)]]\" placeholder=\"[[placeholder]]\">\n        <div hidden$=\"[[!_exists(multiValue)]]\" slot=\"prefix\">\n          <span class=\"prefix\">[[multiValue]]</span>\n        </div>\n      </vaadin-select>\n    `;\n  }\n}\ncustomElements.define('dnd-select-add', DndSelectAdd);","import { PolymerElement, html } from '@polymer/polymer';\nimport { MDCRipple } from '@material/ripple';\nimport { } from '@polymer/polymer/lib/elements/dom-if.js';\n\nclass DndButton extends PolymerElement {\n  static get properties() {\n    return {\n      label: {\n        type: String,\n        value: ''\n      },\n      icon: {\n        type: String,\n        value: ''\n      }\n    }\n  }\n\n  connectedCallback() {\n    this.button = new MDCRipple(this.$.button);\n  }\n\n  _exists(i) {\n    return !!i;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles\">\n        .mdc-tab-scroller__scroll-area--scroll {\n          overflow-x: auto;\n          background-color: var(--mdc-theme-surface);\n          border: 1px solid var(--mdc-theme-text-divider-on-background);\n          border-bottom: none;\n        }\n      </style>\n      <button id=\"button\" class=\"mdc-button\">\n        <div class=\"mdc-button__ripple\"></div>\n        <span class=\"mdc-button__label\">[[label]]</span>\n        <template is=\"dom-if\" if=\"[[_exists(icon)]]\">\n          <i class=\"material-icons mdc-button__icon\" aria-hidden=\"true\">[[icon]]</i>\n        </template>\n      </button>\n    `;\n  }\n\n}\ncustomElements.define('dnd-button', DndButton);","import { PolymerElement, html } from \"@polymer/polymer\";\nimport { getSelectedCharacter, getASIForLevel, getCharacterChannel, setASI, getFeatReference, setFeatAttributeSelection } from \"../util/charBuilder\";\n\nclass DndAsiSelect extends PolymerElement {\n  \n  static get properties() {\n    return {\n      levelIndex: {\n        type: Number\n      },\n      checked: {\n        type: Boolean,\n        value: false\n      },\n      selectedFeat: {\n        type: Object\n      },\n      selectedAbility1: {\n        type: String,\n        value: ''\n      },\n      selectedAbility2: {\n        type: String,\n        value: ''\n      },\n      featHasAttributeChoice: {\n        type: Boolean,\n        value: false\n      },\n      featAttributeSelection: {\n        type: String,\n        value: ''\n      },\n      featAttributeOptions: {\n        type: Array,\n        value: []\n      }\n    };\n  }\n\n  constructor() {\n    super();\n    this.attributeOptions = [\n      \"STR\",\n      \"DEX\",\n      \"CON\",\n      \"INT\",\n      \"WIS\",\n      \"CHA\"\n    ]\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.switchChangeHandler = (e) => {\n      this.checked = e.detail.checked;\n      this._genASICallback()();\n    }\n    this.addEventListener(\"switch-change\", this.switchChangeHandler);\n\n    this.characterChangeHandler = (e) => {\n      let character = e.detail.character;\n      this.updateFromCharacter(character);\n    };\n    \n    this.updateFromCharacter(getSelectedCharacter());\n    getCharacterChannel().addEventListener(\"character-selected\", this.characterChangeHandler);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    this.removeEventListener(\"switch-change\", this.switchChangeHandler);\n    getCharacterChannel().removeEventListener(\"character-selected\", this.characterChangeHandler);\n  }\n\n  async updateFromCharacter(character) {\n    const { asi, index } = await getASIForLevel(this.levelIndex, character);\n\n    this.featHasAttributeChoice = false;\n    if (asi) {\n      this.selectedFeat = asi.feat;\n      this.selectedAbility1 = asi.ability1;\n      this.selectedAbility2 = asi.ability2;\n      this.checked = asi.isFeat;\n\n      if (asi.isFeat && asi.feat && asi.feat.name && asi.feat.source) {\n        const featId = `${asi.feat.name}_${asi.feat.source}`;\n        const featRef = await getFeatReference(featId);\n\n        if (featRef.ability && featRef.ability.length && featRef.ability[0].choose) {\n          this.featHasAttributeChoice = true;\n          this.featAttributeOptions = featRef.ability[0].choose.from.map(i => { return i.toUpperCase() });\n          this.featAttributeSelection = character.featAttributeSelections && character.featAttributeSelections[featId] \n            ? character.featAttributeSelections[featId] : '';\n        }\n      }\n    } else {\n      this.selectedFeat = { name: '', source: '' };\n      this.selectedAbility1 = '';\n      this.selectedAbility2 = '';\n      this.checked = false;\n    }\n    this.asiIndex = index;\n  }\n\n  _genASICallback(keyForChange) {\n    return (newVal) => {\n      setASI({\n        feat: keyForChange === 'feat' ? { name: newVal.name, source: newVal.source } : this.selectedFeat,\n        ability1: keyForChange === 'ability1' ? newVal : this.selectedAbility1,\n        ability2: keyForChange === 'ability2' ? newVal : this.selectedAbility2,\n        isFeat: this.checked\n      }, this.asiIndex);\n    }\n  }\n\n  _genFeatAbilityCallback() {\n    return (newVal) => {\n      if (this.selectedFeat && this.selectedFeat.name && this.selectedFeat.source) {\n        const featId = `${this.selectedFeat.name}_${this.selectedFeat.source}`;\n        setFeatAttributeSelection(featId, newVal);\n      }\n    }\n  }\n\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: flex;\n          flex-direction: column;\n          max-width: 192px;\n        }\n        [hidden] {\n          display: none !important;\n        }\n        .abilities {\n          display: flex;\n          flex-wrap: wrap;\n        }\n        .abilities dnd-select-add {\n          width: calc(50% - 8px);\n        }\n        dnd-select-add + dnd-select-add {\n          margin-left: 16px;\n        }\n        dnd-select-add {\n          display: block;\n        }\n      </style>\n\n      <dnd-switch initial-value=[[checked]] label=\"ASI\" secondary-label=\"Feat\"></dnd-switch>\n      <div class=\"abilities\" hidden$=[[checked]]>\n        <dnd-select-add add-callback=\"[[_genASICallback('ability1')]]\" value=\"[[selectedAbility1]]\" options=\"[[attributeOptions]]\" placeholder=\"<ASI>\"></dnd-select-add>\n        <dnd-select-add add-callback=\"[[_genASICallback('ability2')]]\" value=\"[[selectedAbility2]]\" options=\"[[attributeOptions]]\" placeholder=\"<ASI>\"></dnd-select-add>\n      </div>\n      <div hidden$=[[!checked]]>\n        <dnd-select-add add-callback=\"[[_genASICallback('feat')]]\" model=\"feats\" value=\"[[selectedFeat.name]]\" placeholder=\"<Choose Feat>\"></dnd-select-add>\n      </div>\n      <div hidden$=[[!featHasAttributeChoice]]>\n        <dnd-select-add test add-callback=\"[[_genFeatAbilityCallback()]]\" value=\"[[featAttributeSelection]]\" options=\"[[featAttributeOptions]]\" placeholder=\"<Choose Attribute>\"></dnd-select-add>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-asi-select\", DndAsiSelect);","export const classOptionsMap = {\n  \"artificer(ua)\": {\n    class: {\n      2: {\n        name: \"Wonderous Invention\",\n        count: 1,\n        options: [\"{@item Bag of holding}\", \"{@item cap of water breathing}\", \"{@item driftglobe}\", \"{@item goggles of night}\", \"{@item sending stones}\"]\n      },\n      5: {\n        name: \"Wonderous Invention\",\n        count: 1,\n        options: [\"{@item Alchemy jug}\", \"{@item helm of comprehending languages}\", \"{@item lantern of revealing}\", \"{@item ring of swimming}\", \"{@item robe of useful items}\", \"{@item rope of climbing}\", \"{@item wand of magic detection}\", \"{@item wand of secrets}\", \"{@item Bag of holding}\", \"{@item cap of water breathing}\", \"{@item driftglobe}\", \"{@item goggles of night}\", \"{@item sending stones}\"]\n      },\n      10: {\n        name: \"Wonderous Invention\",\n        count: 1,\n        options: [\"{@item Bag of beans}\", \"{@item chime of opening}\", \"{@item decanter of endless water}\", \"{@item eyes of minute seeing}\", \"{@item folding boat}\", \"{@item Heward's handy haversack}\", \"{@item Alchemy jug}\", \"{@item helm of comprehending languages}\", \"{@item lantern of revealing}\", \"{@item ring of swimming}\", \"{@item robe of useful items}\", \"{@item rope of climbing}\", \"{@item wand of magic detection}\", \"{@item wand of secrets}\", \"{@item Bag of holding}\", \"{@item cap of water breathing}\", \"{@item driftglobe}\", \"{@item goggles of night}\", \"{@item sending stones}\"]\n      },\n      15: {\n        name: \"Wonderous Invention\",\n        count: 1,\n        options: [\"{@item Boots of striding and springing}\", \"{@item bracers of archery}\", \"{@item brooch of shielding}\", \"{@item broom of flying}\", \"{@item hat of disguise}\", \"{@item slippers of spider climbing}\", \"{@item Bag of beans}\", \"{@item chime of opening}\", \"{@item decanter of endless water}\", \"{@item eyes of minute seeing}\", \"{@item folding boat}\", \"{@item Heward's handy haversack}\", \"{@item Alchemy jug}\", \"{@item helm of comprehending languages}\", \"{@item lantern of revealing}\", \"{@item ring of swimming}\", \"{@item robe of useful items}\", \"{@item rope of climbing}\", \"{@item wand of magic detection}\", \"{@item wand of secrets}\", \"{@item Bag of holding}\", \"{@item cap of water breathing}\", \"{@item driftglobe}\", \"{@item goggles of night}\", \"{@item sending stones}\"]\n      },\n      20: {\n        name: \"Wonderous Invention\",\n        count: 1,\n        options: [\"{@item Eyes of the eagle}\", \"{@item gem of brightness}\", \"{@item gloves of missile snaring}\", \"{@item gloves of swimming and climbing}\", \"{@item ring of jumping}\", \"{@item ring of mind shielding}\", \"{@item wings of flying}\", \"{@item Boots of striding and springing}\", \"{@item bracers of archery}\", \"{@item brooch of shielding}\", \"{@item broom of flying}\", \"{@item hat of disguise}\", \"{@item slippers of spider climbing}\", \"{@item Bag of beans}\", \"{@item chime of opening}\", \"{@item decanter of endless water}\", \"{@item eyes of minute seeing}\", \"{@item folding boat}\", \"{@item Heward's handy haversack}\", \"{@item Alchemy jug}\", \"{@item helm of comprehending languages}\", \"{@item lantern of revealing}\", \"{@item ring of swimming}\", \"{@item robe of useful items}\", \"{@item rope of climbing}\", \"{@item wand of magic detection}\", \"{@item wand of secrets}\", \"{@item Bag of holding}\", \"{@item cap of water breathing}\", \"{@item driftglobe}\", \"{@item goggles of night}\", \"{@item sending stones}\"]\n      }\n    }\n  },\n  \"artificer (revisited)\": {\n    class: {\n      2: {\n        name: \"Infuse Item\",\n        count: 3,\n        type: \"featureType=ai|source=UAArtificerRevisited\"\n      },\n      4: {\n        name: \"Infuse Item\",\n        count: 1,\n        type: \"featureType=ai|source=UAArtificerRevisited\"\n      },\n      7: {\n        name: \"Infuse Item\",\n        count: 1,\n        type: \"featureType=ai|source=UAArtificerRevisited\"\n      },\n      11: {\n        name: \"Infuse Item\",\n        count: 1,\n        type: \"featureType=ai|source=UAArtificerRevisited\"\n      },\n      15: {\n        name: \"Infuse Item\",\n        count: 1,\n        type: \"featureType=ai|source=UAArtificerRevisited\"\n      },\n      19: {\n        name: \"Infuse Item\",\n        count: 1,\n        type: \"featureType=ai|source=UAArtificerRevisited\"\n      }\n    }\n  },\n  artificer: {\n    class: {\n      2: {\n        name: \"Infuse Item\",\n        count: 4,\n        type: \"featureType=ai|source=ERLW\"\n      },\n      6: {\n        name: \"Infuse Item\",\n        count: 2,\n        type: \"featureType=ai|source=ERLW\"\n      },\n      10: {\n        name: \"Infuse Item\",\n        count: 2,\n        type: \"featureType=ai|source=ERLW\"\n      },\n      14: {\n        name: \"Infuse Item\",\n        count: 2,\n        type: \"featureType=ai|source=ERLW\"\n      },\n      18: {\n        name: \"Infuse Item\",\n        count: 2,\n        type: \"featureType=ai|source=ERLW\"\n      }\n    }\n  },\n  barbarian: {\n    subclasses: {\n      \"Path of the Totem Warrior\": {\n        3: {\n          name: \"Totem Spirit\",\n          count: 1,\n          options: [\"Bear\", \"Eagle\", \"Elk\", \"Wolf\", \"Tiger\"]\n        },\n        6: {\n          name: \"Aspect of the Beast\",\n          count: 1,\n          options: [\"Bear\", \"Eagle\", \"Elk\", {\n            name: \"Tiger\",\n            options: [\"athletics\", \"acrobatics\", \"stealth\", \"survival\"],\n            choose: 2,\n            type: \"proficiency\"\n          }, \"Wolf\"]\n        },\n        14: {\n          name: \"Totemic Attunement\",\n          count: 1,\n          options: [\"Bear\", \"Eagle\", \"Elk\", \"Tiger\", \"Wolf\"]\n        }\n      }\n    }\n  },\n  bard: {\n    subclasses: {\n      \"College of Swords\": {\n        3: {\n          name: \"Fighting Style\",\n          count: 1,\n          type: \"fs:b\"\n        }\n      }\n    }\n  }\n};\n\nexport const proficiencyGains = {\n  classes: {\n    \"artificer(ua)\": {\n      subclasses: {\n        \"Gunsmith\": {\n          1: {\n            name: \"Master Smith\",\n            value: \"{@item smith's tools|phb}\"\n          }\n        }\n      }\n    },\n    \"Artificer (Revisited)\": {\n      subclasses: {\n        \"Alchemist\": {\n          3: {\n            name: \"Tools of the Trade\",\n            value: [\"{@item alchemist's supplies|phb}\", \"{@item herbalism kit|phb}\"]\n          }\n        },\n        \"Archivist\": {\n          3: {\n            name: \"Tools of the Trade\",\n            value: [\"{@item calligrapher's supplies|phb}\", \"{@item forgery kit|phb}\"]\n          }\n        },\n        \"Artillerist\": {\n          3: {\n            name: \"Tools of the Trade\",\n            value: [\"{@item smith's tools|phb}\", \"{@item woodcarver's tools|phb}\"]\n          }\n        },\n        \"Battle Smith\": {\n          3: [\n            {\n              name: \"Tools of the Trade\",\n              value: [\"{@item leatherworker's tools|phb}\", \"{@item smith's tools|phb}\"]\n            }, \n            {\n              name: \"Battle Ready\",\n              value: \"martial weapons\"\n            }\n          ]\n        }\n      }\n    },\n    artificer: {\n      subclasses: {\n        \"Alchemist\": {\n          3: {\n            name: \"Tool Proficiency\",\n            value: \"alchemist's supplies\",\n            orOther: true,\n            type: \"artisan's tools\"\n          }\n        },\n        \"Artillerist\": {\n          3: {\n            name: \"Tool Proficiency\",\n            value: \"woodcarver's supplies\"\n          }\n        },\n        \"Battle Smith\": {\n          3: [\n            {\n              name: \"Tool Proficiency\",\n              value: \"smith's supplies\"\n            },\n            {\n              name: \"Battle Ready\",\n              value: \"martial weapons\"\n            }\n          ]\n        },\n        \"Armorer (UA)\": {\n          3: {\n            name: \"Tricks of the Trade\",\n            value: [\"heavy armor\", \"smith's tools\"]\n          }\n        }\n      }\n    }\n  }\n};\n\nexport const spellGains = {\n  classes: {\n    \"artificer(ua)\": {\n      subclasses: {\n        \"Gunsmith\": {\n          1: {\n            name: \"\",\n            value: \"mending\"\n          }\n        }\n      }\n    },\n    \"Artificer (Revisited)\": {\n      subclasses: {\n        \"Alchemist\": {\n          14: {\n            name: \"Chemical Savant\",\n            value: \"greater restoration\",\n            noSlot: true,\n            noMaterial: true,\n            recharge: \"long rest\"\n          }\n        }\n      }\n    },\n    \"artificer\": {\n      subclasses: {\n        \"Alchemist\": {\n          14: {\n            name: \"Chemical Mastery\",\n            value: [\"greater restoration\", \"heal\"],\n            noSlot: true,\n            noMaterial: true,\n            recharge: \"long rest\"\n          }\n        }\n      }\n    },\n    barbarian: {\n      subclasses: {\n        \"Path of the Totem Warrior\": {\n          3: {\n            name: \"Spirit Seeker\",\n            value: [\"beast sense\", \"speak with animals\"],\n            ritualOnly: true,\n            noSlot: true\n          }\n        },\n        \"Path of the Ancestral Guardian v2 (UA)\": {\n          10: {\n            name: \"Consult the Spirits\",\n            value: \"clairvoyance\",\n            noSlot: true\n          }\n        },\n        \"Path of the Ancestral Guardian\": {\n          10: {\n            name: \"Consult the Spirits\",\n            value: [\"augury\", \"clairvoyance\"],\n            noSlot: true,\n            noMaterial: true,\n            recharge: \"short rest\"\n          }\n        },\n        \"Path of the Wild Soul (UA)\": {\n          3: {\n            name: \"Lingering Magic\",\n            value: \"detect magic\",\n            noSlot: true,\n            noMaterial: true,\n            recharge: \"long rest\",\n            charges: \"con\"\n          }\n        }\n      }\n    },\n    bard: {\n      subclasses: {\n        \"College of Lore\": {\n          6: {\n            name: \"\",\n            count: 2,\n            list: \"any\"\n          }\n        }\n      },\n      class: {\n        10: {\n          name: \"Magical Secrets\",\n          count: 2,\n          list: \"any\"\n        },\n        14: {\n          name: \"\",\n          count: 2,\n          list: \"any\"\n        },\n        18: {\n          name: \"\",\n          count: 2,\n          list: \"any\"\n        }\n      }\n    }\n  }\n};\n\nexport const expertiseClasses = {\n  \"artificer(ua)\": {\n    2: {\n      name: \"Tool Expertise\",\n      type: \"artificier-tools\"\n    }\n  },\n  \"Artificer (Revisited)\": {\n    3: {\n      name: \"Tool Expertise\",\n      type: \"artificier-tools\"\n    }\n  },\n  \"Artificer\": {\n    6: {\n      name: \"Tool Expertise\",\n      type: \"artificier-tools\"\n    }\n  },\n  bard: {\n    3: 2,\n    10: 2\n  }\n};\n\nexport const itemGains = {\n  \"Artificer (Revisited)\": {\n    subclasses: {\n      \"Alchemist\": {\n        3: {\n          name: \"Tools of the Trade\",\n          value: [\"{@item alchemist's supplies|phb}\", \"{@item herbalism kit|phb}\"]\n        }\n      },\n      \"Archivist\": {\n        3: {\n          name: \"Tools of the Trade\",\n          value: [\"{@item calligrapher's supplies|phb}\", \"{@item forgery kit|phb}\"]\n        }\n      },\n      \"Artillerist\": {\n        3: {\n          name: \"Tools of the Trade\",\n          value: [\"{@item smith's tools|phb}\", \"{@item woodcarver's tools|phb}\", \"a nonmagical, wooden wand\"]\n        }\n      },\n      \"Battle Smith\": {\n        3: {\n          name: \"Tools of the Trade\",\n          value: [\"{@item leatherworker's tools|phb}\", \"{@item smith's tools|phb}\"]\n        }\n      }\n    }\n  }\n};\n\nexport const resistanceGains = {\n  class: {\n    \"Artificer (Revisited)\": {\n      subclasses: {\n        \"Alchemist\": {\n          14: [\n            {\n              name: \"Chemical Savant\",\n              level: \"resistance\",\n              type: \"damage\",\n              value: \"acid\"\n            },\n            {\n              name: \"Chemical Savant\",\n              level: \"resistance\",\n              type: \"damage\",\n              value: \"poison\"\n            },\n            {\n              name: \"Chemical Savant\",\n              level: \"immunity\",\n              type: \"condition\",\n              value: \"poisoned\"\n            }\n          ]\n        }\n      }\n    }\n  },\n  artificer: {\n    subclasses: {\n      \"Alchemist\": {\n        15: [\n          {\n            name: \"Chemical Mastery\",\n            level: \"resistance\",\n            type: \"damage\",\n            value: \"acid\"\n          },\n          {\n            name: \"Chemical Mastery\",\n            level: \"resistance\",\n            type: \"damage\",\n            value: \"poison\"\n          },\n          {\n            name: \"Chemical Mastery\",\n            level: \"immunity\",\n            type: \"condition\",\n            value: \"poisoned\"\n          }\n        ]\n      }\n    }\n  }\n};\n","import { PolymerElement, html } from \"@polymer/polymer\";\nimport { MutableData } from '@polymer/polymer/lib/mixins/mutable-data.js';\nimport { getCharacterChannel, getSelectedCharacter, getClassReferences, setClassLevels, mergeSubclass, setClassSkillProficiencies, getSubclassChoiceLevel, mergeFeature, setSubclassChoice, setClassChoice, getSubclassChoice, getClassChoice} from \"../../../util/charBuilder\";\nimport \"@vaadin/vaadin-grid\";\nimport \"../../dnd-select-add\";\nimport \"../../dnd-switch\";\nimport \"../../dnd-button\";\nimport \"../../dnd-asi-select\";\nimport \"../../dnd-svg\";\nimport { jqEmpty, getEntryName } from \"../../../js/utils\";\nimport { classOptionsMap } from \"../../../data/choices\";\nimport EntryRenderer from \"../../../util/entryrender\";\nimport { } from '@polymer/polymer/lib/elements/dom-if.js';\nimport { } from '@polymer/polymer/lib/elements/dom-repeat.js';\nimport { getEditModeChannel } from \"../../../util/editMode\";\nimport {filterModel} from \"../../../util/data\";\n\nclass DndCharacterBuilderClass extends MutableData(PolymerElement) {\n  \n  static get properties() {\n    return {\n      levels: {\n        type: Array,\n        value: []\n      },\n      classes: {\n        type: Object,\n      },\n      subclasses: {\n        type: Object,\n        value: undefined\n      },\n      heightByRows: {\n        type: Boolean,\n        value: () => {\n          return window.innerWidth < 900;\n        }\n      },\n      isEditMode: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.characterChangeHandler = (e) => {\n      let character = e.detail.character;\n      this.updateFromCharacter(character);\n    };\n    \n    this.updateFromCharacter(getSelectedCharacter());\n    getCharacterChannel().addEventListener(\"character-selected\", this.characterChangeHandler);\n\n    this.editModeHandler = (e) => {\n      this.isEditMode = e.detail.isEditMode;\n    }\n    getEditModeChannel().addEventListener('editModeChange', this.editModeHandler);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    getCharacterChannel().removeEventListener(\"character-selected\", this.characterChangeHandler);\n    getEditModeChannel().removeEventListener('editModeChange', this.editModeHandler);\n  }\n\n  ready() {\n    super.ready();\n\n    const renderer = new EntryRenderer();\n\n    setTimeout(() => {\n      const grid = this.$.classGrid;\n      let draggedItem;\n\n      grid.rowDetailsRenderer = ((root, grid, rowData) => {\n        if (!root.firstElementChild) {\n          root.innerHTML =\n          '<div class=\"details\" id=\"stats\"></div>';\n        }\n        let renderStack = [],\n          features = this._getClassLevelFeatures(this.levels, rowData.index, this.classes, this.subclasses);\n        \n        for (let feature of features) {\n          renderer.recursiveEntryRender(\n            feature,\n            renderStack,\n            0,\n            undefined,\n            true\n          );\n        }\n\n        const deets = root.querySelector('.details');\n        jqEmpty(deets);\n        deets.innerHTML = renderStack.join(\"\");\n      }).bind(this);\n\n      // grid.addEventListener('grid-dragstart', function(e) {\n      //   draggedItem = e.detail.draggedItems[0];\n      //   grid.dropMode = 'between';\n      // });\n\n      // grid.addEventListener('grid-dragend', function(e) {\n      //   draggedItem = grid.dropMode = null;\n      // });\n\n      // grid.addEventListener('grid-drop', function(e) {\n      //   const dropTargetItem = e.detail.dropTargetItem;\n      //   if (draggedItem && draggedItem !== dropTargetItem) {\n      //     // Reorder the items\n      //     const items = grid.items.filter(function(i) {\n      //       return i !== draggedItem;\n      //     });\n      //     const dropIndex = items.indexOf(dropTargetItem)\n      //       + (e.detail.dropLocation === 'below' ? 1 : 0);\n      //     items.splice(dropIndex, 0, draggedItem);\n      //     setClassLevels(items);\n      //   }\n      // });\n    }, 0);\n  }\n\n  async updateFromCharacter(character) {\n    this.character = character;\n    this.classes = await getClassReferences(character);\n    this.subclasses = JSON.parse(JSON.stringify(character.subclasses));\n\n    this.classChoices = await this._findLevelChoices(character, this.classes);\n\n    this.dispatchEvent(new CustomEvent(\"loadingChange\", { bubbles: true, composed: true }));\n\n    this.levels = character.levels;\n    this.$.classGrid.clearCache();\n  }\n\n  _getClassLevelFeatures(levels, index, classes, subclasses) {\n    if (classes && levels[index] && subclasses) {\n      const className = levels[index].name;\n      const classRef = classes[className];\n\n      if (classRef) {\n        const classFeatures = classRef.classFeatures;\n        let levelsInClass = -1;\n        let levelsInSubclass = -1;\n\n        if (levels.length >= index + 1) {\n          for (let i = 0; i <= index; i ++) {\n            if (levels[i].name === className) {\n              levelsInClass ++;\n\n              const classFeaturesForLevel = classFeatures[levelsInClass];\n              if (classFeaturesForLevel) {\n                const hasSubclassFeature = classFeaturesForLevel.find(i => i.gainSubclassFeature);\n                if (hasSubclassFeature) {\n                  levelsInSubclass ++;\n                }\n              }\n            }\n          }\n\n          const classFeaturesForLevel = classFeatures[levelsInClass];\n          if (classFeaturesForLevel) {\n            const hasSubclassFeature = classFeaturesForLevel.some(i => i.gainSubclassFeature);\n            if (hasSubclassFeature && subclasses && subclasses[className] && classRef.subclasses && classRef.subclasses.length) {\n              const subclassDef = classRef.subclasses.find(i => subclasses[className].name === i.name);\n              if (subclassDef.subclassFeatures[levelsInSubclass]) {\n                subclassDef.subclassFeatures[levelsInSubclass].map((i) => { i.isSubclass = true; return i; })\n                return [...classFeaturesForLevel].concat(subclassDef.subclassFeatures[levelsInSubclass]);\n              }\n            }\n            return classFeaturesForLevel;\n          }\n        }\n      }\n    }\n  }\n\n  _getClassLevelFeatureStringArray(levels, index, classes, subclasses) {\n    if (levels && index !== undefined && classes && subclasses) {\n      const classLevelFeatures = this._getClassLevelFeatures(levels, index, classes, subclasses);\n\n      if (classLevelFeatures) {\n        return classLevelFeatures.map(f => {\n          return { name: getEntryName(f), isSubclass: f.isSubclass };\n        });\n      }\n    }\n  }\n\n  _level(index) {\n    return index + 1;\n  }\n\n  _deleteLevel(e) {\n    let index = e.model.__data.index;\n    this.levels.splice(index, 1);\n    setClassLevels(this.levels);\n  }\n\n  _expandDetails(e) {\n    let data = e.model.__data.item,\n      stayClosed = this.$.classGrid.detailsOpenedItems.indexOf(data) > -1;\n\n    for (let item of this.$.classGrid.detailsOpenedItems) {\n      this.$.classGrid.closeItemDetails(item);\n    }\n\n    if (stayClosed) {\n      this.$.classGrid.closeItemDetails(data);\n    } else {\n      this.$.classGrid.openItemDetails(data);\n    }\n  }\n\n  async _findLevelChoices(character, classes) {\n    const levelChoices = [];\n    if (character && character.levels && character.levels.length) {\n      for (let i = 0; i < character.levels.length; i++) {\n        levelChoices.push(await this._findChoices(character, classes, i));\n      }\n    }\n    return levelChoices;\n  }\n\n  async _findChoices(character, classes, levelIndex) {\n    if (classes && character.levels && character.levels.length && character.levels.length > levelIndex) {\n      let levels = character.levels,\n        subclasses = character.subclasses,\n        name = levels[levelIndex].name,\n        classDef = classes[name];\n\n      if (classDef) {\n        let choices = [],\n          classLevelCount = 0,\n          subclassChoiceLevel = getSubclassChoiceLevel(classDef);\n\n        for (let i = 0; i <= levelIndex; i++) {\n          let level = levels[i]\n          if (level.name === name) {\n            classLevelCount ++;\n          }\n        }\n\n        if (subclassChoiceLevel !== undefined && classLevelCount === subclassChoiceLevel) {\n          choices.push({\n            id: \"subclass\",\n            from: classDef.subclasses,\n            selections: character.subclasses[name]\n          });\n        }\n\n        let features = this._getClassLevelFeatures(levels, levelIndex, classes);\n        if (features && features.length\n            && features.find((f) => { return f.name === \"Ability Score Improvement\"; })) {\n          choices.push({\n            id: \"asi\"\n          });\n        }\n\n        if (levelIndex === 0) {\n          const classSkillOptions = classDef.startingProficiencies.skills[0].choose;\n          choices.push({\n            id: \"profs\",\n            count: classSkillOptions.count,\n            from: classSkillOptions.from,\n            selections: character.classSkillProficiencies\n          });\n        }\n\n        if (classLevelCount) {\n          const classOptions = classOptionsMap[name.toLowerCase()];\n\n          if (classOptions && classOptions.class && classOptions.class[classLevelCount]) {\n            const classLevelOptions = [].concat(classOptions.class[classLevelCount]);\n            \n            for (const classLevelOption of classLevelOptions) {\n              if (classLevelOption.options) {\n                choices.push({\n                  id: \"classFeature\",\n                  name: classLevelOption.name,\n                  from: classLevelOption.options,\n                  count: classLevelOption.count > 1 ? classLevelOption.count : undefined,\n                  class: name.toLowerCase(),\n                  feature: classLevelOption.name,\n                  level: classLevelCount,\n                  selections: getClassChoice(name.toLowerCase(), classLevelCount, classLevelOption.name)\n                });\n              } else if (classLevelOption.type) {\n                const options = await filterModel(\"features\", classLevelOption.type);\n                choices.push({\n                  id: \"classFeature\",\n                  name: classLevelOption.name,\n                  from: options,\n                  count: classLevelOption.count > 1 ? classLevelOption.count : undefined,\n                  class: name.toLowerCase(),\n                  feature: classLevelOption.name,\n                  level: classLevelCount,\n                  selections: getClassChoice(name.toLowerCase(), classLevelCount, classLevelOption.name)\n                });\n              }\n            }\n          }\n\n          if (classOptions && classOptions.subclasses && subclasses[name] && classOptions.subclasses[subclasses[name]] && classOptions.subclasses[subclasses[name]][classLevelCount]) {\n            const subclassLevelOptions = [].concat(classOptions.subclasses[subclasses[name]][classLevelCount]);\n            \n            for (const subclassLevelOption of subclassLevelOptions) {\n              if (subclassLevelOption.options) {\n                choices.push({\n                  id: \"subclassFeature\",\n                  name: subclassLevelOption.name,\n                  from: subclassLevelOption.options,\n                  count: subclassLevelOption.count > 1 ? subclassLevelOption.count : undefined,\n                  class: name.toLowerCase(),\n                  subclass: subclasses[name],\n                  feature: subclassLevelOption.name,\n                  level: classLevelCount,\n                  selections: getSubclassChoice(name.toLowerCase(), subclasses[name], classLevelCount, subclassLevelOption.name)\n                });\n              } else if (subclassLevelOption.type) {\n                const options = await filterModel(\"features\", subclassLevelOption.type);\n                choices.push({\n                  id: \"subclassFeature\",\n                  name: subclassLevelOption.name,\n                  from: options,\n                  count: subclassLevelOption.count > 1 ? subclassLevelOption.count : undefined,\n                  class: name.toLowerCase(),\n                  subclass: subclasses[name],\n                  feature: subclassLevelOption.name,\n                  level: classLevelCount,\n                  selections: getSubclassChoice(name.toLowerCase(), subclasses[name], classLevelCount, subclassLevelOption.name)\n                });\n              }\n            }\n          }\n        }\n\n        return choices;\n      }\n    }\n    return [];\n  }\n\n  _equal(a, b) {\n    return a === b;\n  }\n\n  _genSubclassCallback(level) {\n    return (subclass) => {\n      mergeSubclass(undefined, level.name, subclass);\n    }\n  }\n\n  _genSubclassOptions(level) {\n    return this.classes[level.name].subclasses;\n  }\n\n  _getSubclassSelection(level, subclasses) {\n    return subclasses[level.name];\n  }\n\n  _classFeatureOptionAddCallback(classs, level, feature) {\n    return (choice) => {\n      let adjChoice;\n      if (Array.isArray(choice)) {\n        adjChoice = choice.map(c => {\n          if (c.name) {\n            return { name: c.name, source: c.source }\n          } else {\n            return c;\n          }\n        });\n      } else if (choice.name) {\n        adjChoice = { name: choice.name, source: choice.source };\n      } else {\n        adjChoice = choice;\n      }\n      setClassChoice(classs, level, feature, adjChoice);\n    };\n  }\n\n  _subclassFeatureOptionAddCallback(classs, subclass, level, feature) {\n    return (choice) => {\n      let adjChoice;\n      if (Array.isArray(choice)) {\n        adjChoice = choice.map(c => {\n          if (c.name) {\n            return { name: c.name, source: c.source }\n          } else {\n            return c;\n          }\n        });\n      } else if (choice.name) {\n        adjChoice = { name: choice.name, source: choice.source };\n      } else {\n        adjChoice = choice;\n      }\n      setSubclassChoice(classs, subclass, level, feature, adjChoice);\n    };\n  }\n\n  _indexOfLevel(level, levels) {\n    return levels.indexOf(level);\n  }\n\n  _isMobile() {\n    return window.innerWidth < 921;\n  }\n\n  _objArray(obj) {\n    return Object.values(obj);\n  }\n\n  _atIndex(data, index) {\n    return data ? data[index] : null;\n  }\n\n  _svgFromClass(className) {\n    return className ? className.replace(/(\\s|\\(|\\))/g, \"\") : '';\n  }\n\n  _addClassLevel(e) {\n    mergeFeature(undefined, e.model.item, \"classes\");\n  }\n\n  _classSkillAddCallback(skills) {\n    setClassSkillProficiencies(skills);\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\">\n        .something {\n          display: block;\n        }\n        #stats {\n          margin-top: 16px;\n          line-height: 1.9;\n        }\n        .details {\n          padding: 0 24px;\n        }\n\n        .heading-wrap {\n          display: flex;\n          justify-content: space-between;\n          margin: 22px 14px 5px;\n          align-items: center;\n        }\n\n        .button-wrap {\n          display: flex;\n          flex-wrap: wrap;\n          align-items: center;\n          padding: 10px;\n        }\n        .button-wrap > * {\n          margin: 4px;\n        }\n\n        .row {\n          position: relative;\n        }\n        .row:after {\n          content: \"\";\n          display: table;\n          clear: both;\n        }\n\n        .open-details {\n          cursor: pointer;\n          display: flex;\n          align-items: flex-start;\n          flex-wrap: wrap;\n        }\n        .open-details:hover {\n          color: var(--mdc-theme-secondary);\n        }\n\n        .level-col {\n          width: 200px;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          overflow: hidden;\n          flex-shrink: 0;\n          padding: 6px 0;\n        }\n        .level-col__level {\n          margin-right: 10px;\n          font-size: 20px;\n          font-weight: bold;\n        }\n        .level-col__image-wrap {\n          width: 30px;\n          position: relative;\n          height: 21px;\n          display: inline-block;\n        }\n        .level-col__image {\n          width: 30px;\n          height: 30px;\n          display: block;\n          position: absolute;\n          top: -1px;\n        }\n        .level-col__class {\n          font-size: 20px;\n          font-weight: bold;\n        }\n\n        .features-col {\n          white-space: normal;\n          margin: 0;\n          padding: 8px 0;\n          width: 100%;\n          font-size: 15px;\n        }\n        .class-feature:not(:last-of-type)::after {\n          content: ', ';\n        }\n        .class-feature[subclass] {\n          color: var(--mdc-theme-secondary);\n        }\n\n        .choices-col {\n          display: flex;\n          float: left;\n          flex-wrap: wrap;\n        }\n        .choices-col__choice {\n          margin-right: 16px;\n        }\n        .choices-col__subclass-choice {\n          display: block;\n        }\n\n        .delete-col {\n          position: absolute;\n          right: -8px;\n          top: 4px;\n        }\n        .delete-btn {\n          height: 24px;\n          width: 24px;\n          font-size: 18px;\n          padding: 0;\n        }\n        .delete-btn:hover {\n          color: var(--mdc-theme-secondary);\n        }\n\n        .details {\n          font-size: 14px;\n          width: calc(100% - 30px);\n          margin: 0 auto 13px !important;\n          background: var(--lumo-contrast-10pct);\n          border-radius: 4px;\n          white-space: pre-line;\n          padding: 14px 14px 1px;\n        }\n\n        .details#stats p {\n          line-height: 1.5;\n        }\n\n        @media(min-width: 921px) {\n          .open-details {\n            flex-wrap: nowrap;\n          }\n          .features-col {\n            margin: 0 30px 0 12px;\n            width: unset;\n            font-size: 16px;\n          }\n        }\n      </style>\n\n      <div class=\"heading-wrap\">\n        <dnd-select-add model=\"classes\" placeholder=\"Add a Level\"></dnd-select-add>\n      </div>\n      <div class=\"button-wrap\">\n        <template is=\"dom-repeat\" items=\"[[_objArray(classes)]]\">\n          <dnd-button icon=\"add\" label=\"[[item.name]]\" on-click=\"_addClassLevel\"></dnd-button>\n        </template>\n      </div>\n\n      <vaadin-grid id=\"classGrid\" rows-draggable items=[[levels]] theme=\"no-border\" height-by-rows$=\"[[heightByRows]]\">\n        <vaadin-grid-column flex-grow=\"1\">\n          <template>\n            <div class=\"row\">\n              <div class=\"open-details\" on-click=\"_expandDetails\">\n                <div class=\"level-col\">\n                  <span class=\"level-col__level\">[[_level(index)]]</span>\n                  <span class=\"level-col__image-wrap\" ><dnd-svg class=\"level-col__image\" id=\"[[_svgFromClass(item.name)]]\"></dnd-svg></span>\n                  <span class=\"level-col__class\">[[item.name]]</span>\n                </div>\n\n                <div class=\"features-col\">\n                  <template is=\"dom-repeat\" items=\"[[_getClassLevelFeatureStringArray(levels, index, classes, subclasses)]]\">\n                    <span class=\"class-feature\" subclass$=\"[[item.isSubclass]]\">[[item.name]]</span>\n                  </template>\n                </div>\n              </div>\n\n              <div class=\"choices-col\">\n                <template is=\"dom-repeat\" items=\"[[_atIndex(classChoices, index)]]\" as=\"choice\">\n                  <div class=\"choices-col__choice\">\n                    <template is=\"dom-if\" if=\"[[_equal(choice.id, 'subclass')]]\">\n                      <dnd-select-add class=\"choices-col__subclass-choice\" label=\"Subclass\" placeholder=\"<Choose Subclass>\"\n                        options=\"[[choice.from]]\" value=\"[[choice.selections]]\" add-callback=\"[[_genSubclassCallback(item)]]\"></dnd-select-add>\n                    </template>\n                    <template is=\"dom-if\" if=\"[[_equal(choice.id, 'asi')]]\">\n                      <dnd-asi-select level-index=\"[[_indexOfLevel(item, levels)]]\" character=\"[[character]]\"></dnd-asi-select>\n                    </template>\n                    <template is=\"dom-if\" if=\"[[_equal(choice.id, 'profs')]]\">\n                      <dnd-select-add choices=\"[[choice.count]]\" label=\"Skill Proficiency\" placeholder=\"<Choose Skills>\"\n                        options=\"[[choice.from]]\" value=\"[[choice.selections]]\" add-callback=\"[[_classSkillAddCallback]]\"></dnd-select-add>\n                    </template>\n                    <template is=\"dom-if\" if=\"[[_equal(choice.id, 'classFeature')]]\">\n                      <dnd-select-add choices=\"[[choice.count]]\" label=\"[[choice.name]]\" placeholder=\"<Choose Option>\"\n                        options=\"[[choice.from]]\" value=\"[[choice.selections]]\" add-callback=\"[[_classFeatureOptionAddCallback(choice.class, choice.level, choice.feature)]]\"></dnd-select-add>\n                    </template>\n                    <template is=\"dom-if\" if=\"[[_equal(choice.id, 'subclassFeature')]]\">\n                      <dnd-select-add choices=\"[[choice.count]]\" label=\"[[choice.name]]\" placeholder=\"<Choose Option>\"\n                        options=\"[[choice.from]]\" value=\"[[choice.selections]]\" add-callback=\"[[_subclassFeatureOptionAddCallback(choice.class, choice.subclass, choice.level, choice.feature)]]\"></dnd-select-add>\n                    </template>\n                  </div>\n                </template>\n              </div>\n\n              <div class=\"delete-col\">\n                <button class=\"mdc-icon-button material-icons delete-btn\" on-click=\"_deleteLevel\">close</button>\n              </div>\n            </div>\n          </template>\n        </vaadin-grid-column>\n      </vaadin-grid>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-character-builder-class\", DndCharacterBuilderClass);"],"sourceRoot":""}